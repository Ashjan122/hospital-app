# إعداد نظام تحديث التطبيق

## نظرة عامة
تم إضافة نظام تحديث التطبيق الذي يتحقق من وجود تحديث جديد في Firestore ويعرضه للمستخدم عند فتح التطبيق.

## إعداد Firestore

### 1. إنشاء Collection
أنشئ collection جديد باسم `appConfig` في Firestore.

### 2. إنشاء Document
أنشئ document جديد باسم `appUpdate` في collection `appConfig`.

### 3. إعداد البيانات
أضف البيانات التالية في document `appUpdate`:

```json
{
  "lastVersion": "1.0.1",
  "updatrUrl": "https://your-download-link.com/app.apk",
  "isAvailable": true,
  "forceUpdate": false,
  "message": "يتوفر تحديث جديد للتطبيق مع تحسينات وإصلاحات",
  "createdAt": "2024-01-01T00:00:00.000Z"
}
```

### 4. شرح الحقول

| الحقل | النوع | الوصف |
|-------|-------|-------|
| `lastVersion` | String | رقم الإصدار الجديد (مثال: "1.0.1") |
| `updatrUrl` | String | رابط تحميل التطبيق الجديد |
| `isAvailable` | Boolean | هل التحديث متاح (true/false) |
| `forceUpdate` | Boolean | هل التحديث إجباري (true/false) |
| `message` | String | رسالة تظهر للمستخدم |
| `createdAt` | Timestamp | تاريخ إنشاء التحديث |

## كيفية العمل

### 1. التحقق التلقائي
- عند فتح التطبيق، يتم التحقق من وجود تحديث جديد
- يتم مقارنة الإصدار الحالي مع الإصدار الجديد
- إذا كان الإصدار الجديد أحدث، يتم عرض dialog التحديث

### 2. عرض التحديث
- يتم عرض dialog جميل مع معلومات التحديث
- يظهر الإصدار الحالي والإصدار الجديد
- إذا كان التحديث إجباري، لا يمكن إغلاق dialog

### 3. التحديث
- عند الضغط على "تحديث الآن"، يتم فتح رابط التحميل
- يتم حفظ حالة التحديث لتجنب عرضه مرة أخرى في نفس اليوم

## إدارة التحديثات

### إيقاف التحديث مؤقتاً
```json
{
  "isAvailable": false
}
```

### جعل التحديث إجباري
```json
{
  "forceUpdate": true
}
```

### تحديث الرسالة
```json
{
  "message": "تحديث مهم: إصلاح مشاكل الأمان"
}
```

## الملفات المضافة

1. **`lib/services/app_update_service.dart`** - خدمة التحقق من التحديث
2. **`lib/widgets/app_update_dialog.dart`** - dialog عرض التحديث
3. **`lib/widgets/app_update_wrapper.dart`** - wrapper للتحقق التلقائي

## المكتبات المضافة

- `url_launcher: ^6.2.5` - لفتح روابط التحميل
- `package_info_plus: ^8.0.2` - للحصول على معلومات التطبيق

## ملاحظات مهمة

1. **تنسيق الإصدار**: استخدم تنسيق semantic versioning (مثال: 1.0.1)
2. **رابط التحميل**: تأكد من أن الرابط صحيح ومتاح
3. **التحديث الإجباري**: استخدمه بحذر، خاصة للأخطاء الأمنية المهمة
4. **الرسائل**: اكتب رسائل واضحة ومفيدة للمستخدم

## مثال على التحديث

```json
{
  "lastVersion": "1.1.0",
  "updatrUrl": "https://drive.google.com/file/d/your-file-id/view",
  "isAvailable": true,
  "forceUpdate": false,
  "message": "تحديث جديد: إضافة ميزات جديدة وتحسين الأداء",
  "createdAt": "2024-01-15T10:30:00.000Z"
}
```

## استكشاف الأخطاء

### التحديث لا يظهر
1. تحقق من `isAvailable: true`
2. تحقق من أن `lastVersion` أحدث من الإصدار الحالي
3. تحقق من صحة `updatrUrl`

### خطأ في فتح الرابط
1. تأكد من صحة الرابط
2. تأكد من أن الرابط متاح للجمهور
3. تحقق من إعدادات الأمان في Firestore
