# تحديث التسجيل الدولي وخدمة واتساب

## نظرة عامة
تم تحديث تطبيق المستشفى لدعم إنشاء الحسابات من البلدان المختلفة وإرسال رسائل التحقق عبر واتساب بالإضافة إلى الرسائل النصية.

## الميزات الجديدة

### 1. دعم الأرقام الدولية
- إضافة قائمة منسدلة لاختيار البلد
- دعم 35+ دولة مع رموزها الدولية
- التحقق من صحة أرقام الهواتف حسب كل بلد
- تلميحات مخصصة لكل بلد

### 2. خدمة واتساب
- إرسال رسائل التحقق عبر واتساب باستخدام UltraMsg API
- خيار اختيار طريقة التحقق (رسالة نصية أو واتساب)
- واجهة مستخدم تفاعلية لاختيار طريقة التحقق

### 3. البلدان المدعومة
- السودان (+249)
- السعودية (+966)
- الإمارات (+971)
- قطر (+974)
- مصر (+20)
- تركيا (+90)
- الكويت (+965)
- البحرين (+973)
- عمان (+968)
- الأردن (+962)
- لبنان (+961)
- سوريا (+963)
- العراق (+964)
- ليبيا (+218)
- تونس (+216)
- الجزائر (+213)
- المغرب (+212)
- اليمن (+967)
- فلسطين (+970)
- الولايات المتحدة (+1)
- بريطانيا (+44)
- كندا (+1)
- أستراليا (+61)
- ألمانيا (+49)
- فرنسا (+33)
- إيطاليا (+39)
- إسبانيا (+34)
- روسيا (+7)
- الصين (+86)
- اليابان (+81)
- الهند (+91)
- باكستان (+92)
- بنغلاديش (+880)
- نيجيريا (+234)
- كينيا (+254)
- إثيوبيا (+251)
- أوغندا (+256)
- تنزانيا (+255)
- جنوب أفريقيا (+27)

## الملفات المحدثة

### 1. `lib/models/country.dart`
- نموذج بيانات جديد للبلدان
- قائمة شاملة بالبلدان مع رموزها الدولية
- دوال مساعدة للبحث عن البلدان

### 2. `lib/services/whatsapp_service.dart`
- خدمة جديدة لإرسال رسائل واتساب
- استخدام UltraMsg API
- دعم إرسال رسائل التحقق والرسائل العادية

### 3. `lib/screnns/register_screen.dart`
- إضافة قائمة منسدلة لاختيار البلد
- تحديث التحقق من صحة أرقام الهواتف
- إضافة خيارات طريقة التحقق (SMS/WhatsApp)
- تحديث واجهة المستخدم

### 4. `lib/screnns/otp_verification_screen.dart`
- دعم المعاملات الجديدة (البلد وطريقة التحقق)
- تحديث رسائل النجاح والفشل
- إعادة إرسال الرمز عبر الطريقة المختارة

## إعدادات واتساب API

### UltraMsg API
```dart
static const String _baseUrl = 'https://api.ultramsg.com/instance140877/messages/chat';
static const String _token = 'df2r46jz82otkegg';
```

### مثال على الاستخدام
```dart
// إرسال رسالة تحقق عبر واتساب
Map<String, dynamic> result = await WhatsAppService.sendOTP(phoneNumber, otp);

// إرسال رسالة عادية
Map<String, dynamic> result = await WhatsAppService.sendSimpleMessage(phoneNumber, message);
```

## أنماط التحقق من أرقام الهواتف

### السودان
- 9 أرقام تبدأ بـ 1 أو 9
- مثال: 912345678

### السعودية
- 9 أرقام تبدأ بـ 5
- مثال: 512345678

### الإمارات
- 9 أرقام تبدأ بـ 5
- مثال: 512345678

### قطر
- 8 أرقام تبدأ بـ 3 أو 7
- مثال: 31234567

### مصر
- 10 أرقام تبدأ بـ 1
- مثال: 1012345678

### تركيا
- 10 أرقام تبدأ بـ 5
- مثال: 5012345678

## واجهة المستخدم

### شاشة التسجيل
1. **اختيار البلد**: قائمة منسدلة مع أعلام البلدان
2. **حقل رقم الهاتف**: يتغير التلميح حسب البلد المختار
3. **طريقة التحقق**: خياران (رسالة نصية أو واتساب)
4. **التحقق من الصحة**: يتحقق من صحة الرقم حسب البلد

### شاشة التحقق
1. **رسالة واضحة**: تظهر طريقة التحقق المستخدمة
2. **إعادة الإرسال**: تعيد الإرسال عبر نفس الطريقة
3. **العد التنازلي**: 5 دقائق لانتهاء صلاحية الرمز

## الاختبار

### اختبار الأرقام المختلفة
```dart
// رقم سوداني
String sudanNumber = "912345678";

// رقم سعودي
String saudiNumber = "512345678";

// رقم إماراتي
String uaeNumber = "512345678";
```

### اختبار خدمة واتساب
```dart
// إرسال رسالة تحقق
Map<String, dynamic> result = await WhatsAppService.sendOTP("966512345678", "123456");

// التحقق من النتيجة
if (result['success']) {
  print('تم الإرسال بنجاح');
} else {
  print('فشل الإرسال: ${result['message']}');
}
```

## ملاحظات مهمة

1. **أمان API**: تأكد من تحديث رمز واتساب API في الإنتاج
2. **التحقق من الصحة**: تم إضافة أنماط للبلدان الرئيسية فقط
3. **الأداء**: خدمة واتساب قد تكون أبطأ من SMS في بعض الأحيان
4. **التوافق**: يعمل مع جميع الأجهزة التي تدعم واتساب

## التطوير المستقبلي

1. إضافة المزيد من البلدان
2. تحسين أنماط التحقق من الأرقام
3. إضافة دعم للرسائل متعددة اللغات
4. تحسين واجهة اختيار البلد مع البحث
5. إضافة إحصائيات الاستخدام

## الدعم الفني

في حالة وجود مشاكل:
1. تحقق من اتصال الإنترنت
2. تأكد من صحة رمز واتساب API
3. تحقق من صحة رقم الهاتف المدخل
4. راجع سجلات التطبيق للأخطاء
