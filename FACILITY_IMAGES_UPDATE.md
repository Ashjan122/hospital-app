# تحديث صور المراكز الطبية وترتيبها

## التحديثات المضافة

### 1. إضافة دعم الصور للمراكز الطبية
- تم إضافة حقل `imageUrl` في قاعدة البيانات للمراكز الطبية
- إمكانية رفع الصور من الكاميرا أو المعرض
- عرض الصور في جميع صفحات المراكز الطبية

### 2. إضافة نظام ترتيب المراكز الطبية
- تم إضافة حقل `order` في قاعدة البيانات للمراكز الطبية
- إمكانية تحديد ترتيب كل مركز (رقم 1، 2، 3، إلخ)
- ترتيب المراكز حسب الحقل `order` في صفحة المرافق الطبية

### 3. التعديلات في صفحة الكنترول
- إضافة قسم اختيار الصورة في نموذج إضافة/تعديل المركز
- إضافة حقل "ترتيب المركز" في النموذج
- دعم رفع الصور إلى Firebase Storage
- عرض الصورة المختارة في النموذج
- زر "تحديث ترتيب المراكز" لإضافة حقل `order` للمراكز الموجودة
- **ترتيب المراكز في القائمة**: المراكز المفعلة أولاً، ثم غير المفعلة
- **عرض الترتيب**: إظهار رقم الترتيب لكل مركز في القائمة

### 4. التعديلات في صفحة المرافق الطبية
- استبدال الأيقونات بصور المراكز الفعلية
- عرض الصورة الافتراضية `center.png` إذا لم تكن هناك صورة مخصصة
- **تصميم جديد**: اسم المركز في اليمين والصورة في اليسار
- **ترتيب المراكز**: حسب حقل `order` (تصاعدي)
- تحسين تصميم البطاقات مع الصور

### 5. التعديلات في صفحة تفاصيل المرافق
- إزالة عرض صورة المركز واسمه من أعلى الصفحة (لتبسيط التصميم)
- التركيز على الوظائف الأساسية للصفحة

## الملفات المعدلة

1. `lib/screnns/control_panel_screen.dart`
   - إضافة دعم اختيار ورفع الصور
   - إضافة حقل ترتيب المركز في النموذج
   - تعديل نموذج إضافة/تعديل المركز
   - إضافة دالة `_updateExistingCentersOrder` لتحديث المراكز الموجودة
   - إضافة زر تحديث الترتيب في شريط التطبيق
   - **ترتيب المراكز في القائمة**: تطبيق نفس نظام الترتيب المستخدم في صفحة المرافق
   - **عرض الترتيب**: إظهار رقم الترتيب لكل مركز مع أيقونة الترتيب

2. `lib/screnns/hospital_screen.dart`
   - استبدال الأيقونات بصور المراكز
   - إضافة معالجة الأخطاء للصور
   - إضافة دالة `_hasValidImageUrl` للتحقق الآمن من وجود الصورة
   - **تحديث التصميم**: اسم المركز في اليمين والصورة في اليسار
   - **ترتيب المراكز**: المراكز المفعلة أولاً، ثم غير المفعلة

3. `lib/screnns/facility_details_screen.dart`
   - إزالة عرض صورة المركز واسمه من أعلى الصفحة
   - تبسيط التصميم والتركيز على الوظائف الأساسية

4. `pubspec.yaml`
   - إضافة `assets/images/center.png` إلى الأصول

## كيفية الاستخدام

### إضافة مركز جديد مع ترتيب
1. انتقل إلى صفحة الكنترول
2. اضغط على زر "إضافة مركز جديد"
3. اضغط على الصورة الافتراضية لاختيار صورة
4. اختر "الكاميرا" أو "المعرض"
5. املأ البيانات المطلوبة:
   - اسم المركز
   - عنوان المركز
   - رقم الهاتف
   - **ترتيب المركز** (مثال: 1 للمركز الأول، 2 للمركز الثاني)
6. اضغط "إضافة المركز"

### تعديل مركز موجود
1. انتقل إلى صفحة الكنترول
2. اضغط على زر التعديل بجانب المركز المطلوب
3. عدل البيانات المطلوبة بما في ذلك الترتيب
4. اضغط "تحديث المركز"

### تحديث ترتيب المراكز الموجودة
1. انتقل إلى صفحة الكنترول
2. اضغط على زر "تحديث ترتيب المراكز" (أيقونة الترتيب)
3. سيتم إضافة حقل `order` تلقائياً للمراكز التي لا تحتوي عليه
4. يمكنك بعد ذلك تعديل الترتيب يدوياً لكل مركز

## الصورة الافتراضية
- إذا لم يتم اختيار صورة، سيتم عرض `assets/images/center.png`
- إذا فشل تحميل الصورة من الإنترنت، سيتم عرض الصورة الافتراضية

## نظام الترتيب
- **حقل `order`**: رقم صحيح موجب يحدد ترتيب المركز
- **الترتيب حسب الحالة**:
  1. **المراكز المفعلة أولاً**: مرتبة حسب حقل `order` تصاعدياً
  2. **المراكز غير المفعلة ثانياً**: مرتبة حسب حقل `order` تصاعدياً
- **المراكز بدون ترتيب**: تحصل على رقم 999 (تظهر في النهاية)
- **مثال للترتيب**:
  - مركز الرومي الطبي (مفعل): `order: 1` → يظهر أولاً
  - مركز الرومي لطب وجراحة الأسنان (مفعل): `order: 2` → يظهر ثانياً
  - مركز آخر (غير مفعل): `order: 1` → يظهر بعد المراكز المفعلة

## المتطلبات التقنية
- `image_picker: ^1.0.7` - لاختيار الصور
- `firebase_storage: ^12.2.2` - لرفع الصور
- `path: ^1.9.0` - لمعالجة مسارات الملفات

## ملاحظات مهمة
- الصور يتم رفعها إلى مجلد `facilities/` في Firebase Storage
- يتم ضغط الصور إلى جودة 85% وحجم أقصى 1024x1024 بكسل
- الصور يتم تخزينها بأسماء فريدة لتجنب التعارض
- المراكز يتم ترتيبها حسب حالة التفعيل أولاً، ثم حسب حقل `order`

## إصلاحات الأخطاء

### إصلاح خطأ "field 'imageUrl' does not exist"
- تم إضافة دوال مساعدة للتحقق الآمن من وجود حقل `imageUrl`
- معالجة الحالات التي لا تحتوي المراكز القديمة على حقل الصورة
- استخدام try-catch blocks لتجنب أخطاء الوصول للحقول غير الموجودة

### الدوال المساعدة المضافة:
```dart
// في hospital_screen.dart
bool _hasValidImageUrl(QueryDocumentSnapshot doc) {
  try {
    final data = doc.data() as Map<String, dynamic>?;
    if (data == null) return false;
    
    final imageUrl = data['imageUrl'] as String?;
    return imageUrl != null && imageUrl.trim().isNotEmpty;
  } catch (e) {
    return false;
  }
}
```

## التوافق مع المراكز الموجودة
- المراكز التي تم إنشاؤها قبل هذا التحديث ستعرض الصورة الافتراضية
- المراكز التي لا تحتوي على حقل `order` تحصل على رقم 999
- يمكن تحديث صور وترتيب هذه المراكز من خلال صفحة الكنترول
- لا توجد حاجة لإعادة إنشاء المراكز الموجودة

## التصميم الجديد

### صفحة المرافق الطبية
- **ترتيب العناصر**: اسم المركز في اليمين، الصورة في اليسار
- **الصورة**: 60x60 بكسل (دائرية) 
- **الاسم**: محاذاة لليمين (textAlign: right)
- **حالة "قريبا"**: تحت الاسم للمراكز غير المتاحة
- **التصميم**: أفقي ومنظم مع استغلال أفضل للمساحة
- **الترتيب**: المراكز المفعلة أولاً (حسب `order`)، ثم غير المفعلة

### صفحة تفاصيل المرافق
- **تبسيط**: إزالة قسم الصورة والاسم من أعلى الصفحة
- **التركيز**: على الوظائف الأساسية (احجز الآن، شركات التأمين)
- **تصميم أنظف**: بدون عناصر إضافية غير ضرورية
